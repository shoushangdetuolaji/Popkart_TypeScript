---
typora-root-url: ../img
---

# 类型声明文件-d.ts

## 什么是类型声明文件

> 概念：在 TypeScript 中以**d.ts为后缀的文件**就是类型声明文件，
>
> 作用：为 **js模块提供类型信息支持**，让用户在`使用js模块`的时候也可以获得良好的类型提示，经常在三方库中见到

![](/035.png)

![](/036.png)

![](/037.png)

![](/038.png)

### 和一般的ts文件的区别

1. 一般的TS文件中既可以包含代码逻辑代码同时可以包含类型信息代码，d.ts文件中只能包含类型声明代码
2. 一般的TS文件参与代码编译，最终会生成JS代码，d.ts文件不参与编译，不会生成JS代码

## 文件如何产生的？

项目里的d.ts文件大概可以分为4种情况

1. **库项目本身就是TS开发的，可以在打包库的时候同时自动生成对应的d.ts文件（最常见）**
2. 一些早期的库项目本身是JS开发的，可以借助 `DefinitelyTyped` 三方类型库为其提供对应的d.ts文件
3. 对于JS标准化的API或者标准化的DOM API，TypeScript提供了内置的支持，不需要开发者参与
4. 如果是日常的JS开发，d.ts也可以由开发者手写完成

### 使用 DefinitelyTyped 提供类型声明文件

> 场景：有些库本身并不是采用TS编写的，无法直接生成配套的d.ts文件，但是也想获得类型提示，此时需要 Definitely Typed 提供类型声明文件

![](/039.png)

DefinitelyTyped是一个TS类型定义的仓库，**专门为JS编写的库**提供类型声明，比如我们可以安装`@types/jquery` 为Jquery库提供类型提示

![](/040.png)

### 内置的类型声明文件

> 概念：TS为JS运行时可用的所有标准化内置API都提供了声明文件，这些文件既不需要编译生成，也不需要三方提供

比如当我们访问原生数组的时候，点之后会有非常强大的类型提示，这种提示其实就是内置的标准类型声明文件来辅助完成的

![](/041.png)

鼠标移动到方法名上，会显示内置类型声明文件，点击它会跳转到 `lib.es5.d.ts` 文件里

![](/042.png)

再比如在我们访问标准的DOM对象的时候，同样也可以有类型智能提示

![](/043.png)

再次将鼠标移动到某个方法名身上，点击它会自动跳转到 `lib.dom.d.ts` 文件中

![](/045.png)

说明：这里的lib.es5.d.ts以及lib.dom.d.ts都是内置的类型声明文件，为原生js和浏览器API提供类型提示



### 手写自定义d.ts文件

> 概念：d.ts文件在项目中是可以进行自定义创建的，直接可以给JavaScript文件提供类型支持，这在为JS项目渐进迁移TS的场景比较有用

![](/046.png)

![](/047.png)

说明：通过**declare关键词可以为js文件中的变量声明对应类型**，这样js导出的模块在使用的时候也会获得类型提示

## 库项目中的类型文件是如何生效的

到这里大家可能会有一个疑惑，当我们使用一个三方库，比如axios 的时候，类型声明文件是如何为我们提供类型支持的，为什么我们使用`axios.get`方法的时候会有类型提示？这里设计到TS引擎的类型查找算法，我们简化一下核心步骤：



1. 首先当我们打开axios项目的包文件之后，会看到一个叫做`types`的字段, 这个字段的作用是告诉TS引擎，当我使用axios包的各种方法的时候，自动去找哪个类型文件提供支持，这里我们看到它指定的是 `index.d.ts` 文件

![](/048.png)



2. 当我们打开index.d.ts之后，会发现内部会有各种各样的类型声明语句，这些类型声明语句是axios在打包时把代码中的类型部分剥离出来生成的，和原本的逻辑有严格的对应关系
3. 当我们尝试访问一个 `axios.get` 方法的时候，TS服务引擎会先找到`index.d.ts`, 然后在内部匹配和axios.get方法`对应的类型声明`进行类型校验和类型提示

![](/049.png)